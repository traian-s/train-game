(window["webpackJsonptrain-game"]=window["webpackJsonptrain-game"]||[]).push([[0],{20:function(e,n,t){e.exports=t.p+"static/media/line.2e3e852f.svg"},21:function(e,n,t){e.exports=t.p+"static/media/curve.e4a33090.svg"},22:function(e,n,t){e.exports=t.p+"static/media/bridge.2b4139f0.svg"},23:function(e,n,t){e.exports=t.p+"static/media/switch.90588404.svg"},24:function(e,n,t){e.exports=t.p+"static/media/padure.7a9c9b0c.svg"},25:function(e,n,t){e.exports=t.p+"static/media/gara.830c43ab.svg"},27:function(e,n,t){e.exports=t(40)},39:function(e,n,t){},40:function(e,n,t){"use strict";t.r(n);var o=t(0),a=t.n(o),c=t(9),r=t.n(c),i=t(6),l=t(3),u=t(1),d={bridge:{type:"bridge",connections:[1,1,1,1],allowRotate:!0},curve:{type:"curve",connections:[1,1,0,0],allowRotate:!0},line:{type:"line",connections:[0,1,0,1],allowRotate:!0},switch:{type:"switch",connections:[1,1,0,1],allowRotate:!0},station:{type:"station",connections:[1,1,0,1],allowRotate:!0},forest:{type:"forest",connections:[0,0,0,0],allowRotate:!1}},s=["NORTH","EAST","SOUTH","WEST"],p={FOREST:{type:"FOREST",moves:3,piece:[d.forest.type]},STATIONS:{type:"STATIONS",moves:2,piece:[d.station.type]},TRACKS:{type:"TRACKS",moves:1,piece:[d.bridge.type,d.curve.type,d.line.type,d.switch.type]}},y=function(e){return{type:"SET_GAME_STAGE",payload:e}},b=function(e){return{type:"SET_ACTIVE_PLAYER",payload:e}},m=function(){return function(e,n){var t=n().game,o=t.players,a=t.activeTurn.player,c=o.findIndex((function(e){return e.id===a.id}));o[c+1]||e((function(e,n){var t=n().game.turns.stage;t===p.FOREST&&e(y(p.STATIONS)),t===p.STATIONS&&e(y(p.TRACKS))}));var r=n().game.turns.stage.moves,i={player:o[c+1]?o[c+1]:o[0],moves:{allowed:r,executed:0}};e(v()),e(b(i))}},E=function(){return function(e,n){var t=n().game.activeTurn.moves,o=t.allowed,a=t.executed;e({type:"PLAYER_MOVE_ADD"}),a+1===o&&e(m()),e(T())}},f=t(11),w=[[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}],[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{connections:[1,1,0,1],enabled:!0,ownerId:2,type:"station",rotation:0},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{connections:[0,1,1,1],enabled:!0,ownerId:1,type:"station",rotation:-180},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}],[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}],[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}],[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}],[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}],[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{connections:[1,1,0,1],enabled:!0,ownerId:2,type:"station",rotation:0},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{connections:[1,1,0,1],enabled:!0,ownerId:1,type:"station",rotation:0},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}],[{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null},{enabled:!0,occupied:!1,type:"",rotation:0,connections:[],ownerId:null}]],g=function(e,n,t){return"undefined"!==typeof t[e]&&"undefined"!==typeof t[e][n]},O=function(e,n){var t=[];if((e=e||w).length&&n)return e.map((function(o,a){o.map((function(o,c){o.ownerId===n&&(t=[].concat(Object(l.a)(t),Object(l.a)(function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1,1];return console.log("getAdjacentDirections called with ".concat(e," ").concat(n," ")),g(e,n,t)?[[e-1,n],[e,n+1],[e+1,n],[e,n-1]].filter((function(e,n){return 1===o[n]})).filter((function(e){return g.apply(void 0,Object(l.a)(e).concat([t]))})):null}(a,c,e,o.connections))))}))})),console.log("Legal Moves for player ".concat(n," are: "),t),t},v=function(){return{type:"ENABLE_ALL_PIECES"}},I=function(e,n){return{type:"DISABLE_PIECE",payload:{x:e,y:n}}},T=function(){return function(e,n){var t=n(),o=t.board.gameMap,a=t.game,c=a.activeTurn.player.id;if(a.turns.stage.type===p.TRACKS.type){var r=O(o,c),i=r.map((function(e){return e.join()}));console.log(r),console.log(r.map((function(e){return e.join()}))),i.length&&e({type:"SET_LEGAL_MOVES",payload:{moves:i}})}}},j=t(20),S=t.n(j),_=t(21),A=t.n(_),R=t(22),h=t.n(R),L=t(23),N=t.n(L),M=t(24),C=t.n(M),P=t(25),x=t.n(P),D={line:S.a,curve:A.a,bridge:h.a,switch:N.a,forest:C.a,station:x.a},Y=t(12),k=t(13),B=function(e){var n=e.allowRotate,t=e.internalType,o=e.internalRotate,c=e.hideWheel,r=e.setSelection,i=e.saveSelection,l=e.setRotation,u=e.stage;return a.a.createElement("div",{className:"selection-wheel"},Object.keys(D).filter((function(e){return p[u].piece.includes(e)})).map((function(e,n){return a.a.createElement("div",{key:n,className:"quadrant quadrant-".concat(n),onClick:function(){return r(e)}},a.a.createElement("img",{src:D[e]}))})),a.a.createElement("div",{className:"selection-preview",onClick:function(){return i()}},t&&a.a.createElement("img",{className:"rotate-".concat(o),src:D[t]})),n&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"selection-rotate-right",onClick:function(){return l(90)}},a.a.createElement(Y.a,{icon:k.b})),a.a.createElement("div",{className:"selection-rotate-left",onClick:function(){return l(-90)}},a.a.createElement(Y.a,{icon:k.b}))),a.a.createElement("div",{className:"selection-close",onClick:function(){return c()}},a.a.createElement(Y.a,{icon:k.a})))},W="SET_ALLOW_ROTATE",V="SET_TYPE",G="SET_ROTATE",H="SET_DISABLED",U="SET_ENABLED",X="SHOW_SELECTION_WHEEL",K="HIDE_SELECTION_WHEEL",F=function(e,n){switch(console.log("".concat(n.type," called with payload: ").concat(n.payload)),n.type){case W:return Object(u.a)({},e,{allowRotate:n.payload});case V:return Object(u.a)({},e,{internalType:n.payload});case G:return Object(u.a)({},e,{internalRotate:n.payload});case U:return Object(u.a)({},e,{isEnabled:!0});case H:return Object(u.a)({},e,{isEnabled:!1});case X:return Object(u.a)({},e,{selectionWheel:!0});case K:return Object(u.a)({},e,{selectionWheel:!1})}},q=function(e){var n=e.cornerPiece,t=e.enabled,c=e.rotation,r=e.type,i=e.stage,l=e.posX,u=e.posY,s=e.setPiece,y=Object(o.useReducer)(F,{allowRotate:!1,internalType:r,internalRotate:c||0,isEnabled:!0,selectionWheel:!1}),b=Object(f.a)(y,2),m=b[0],E=m.allowRotate,w=m.internalType,g=m.internalRotate,O=m.isEnabled,v=m.selectionWheel,I=b[1];Object(o.useEffect)((function(){!0===n&&p[i]===p.STATIONS&&I({type:H})}),[i]);var T=function(){return I({type:K})};return a.a.createElement("div",{className:"piece piece-".concat(r," ").concat(t?"enabled":"disabled"," ").concat(v?"show-wheel":"")},a.a.createElement(B,{allowRotate:E,hideWheel:T,internalType:w,internalRotate:g,setSelection:function(e){I({type:V,payload:e}),I({type:W,payload:d[e].allowRotate})},saveSelection:function(){T(),s(l,u,w,g)},setRotation:function(e){I({type:G,payload:360===Math.abs(g+e)?0:g+e})},stage:i}),a.a.createElement("div",{className:"piece-image",onClick:function(){return O?I({type:X}):null}},r&&a.a.createElement("img",{className:"rotate-".concat(c),src:D[r]})))},J={initBoard:function(){return function(e,n){var t=n().board.config,o=t.rows,a=t.columns,c={enabled:!0,occupied:!1,ownerId:null,type:"",rotation:0,connections:[]};e(function(e){return{type:"SET_BOARD",payload:e}}(Array(o).fill(null).map((function(e,n){return Array(a).fill(null).map((function(e,t){return Object(u.a)({},c,{posX:n,posY:t})}))}))))}},initPlayers:function(){return function(e,n){var t=n().game.playerCount,o=Object(l.a)(Array(parseInt(t))).map((function(e,n){return{id:n+1,name:"Player ".concat(n+1)}}));e(function(e){return{type:"SET_PLAYERS",payload:e}}(o)),e(y(p.STATIONS));var a={player:Object(u.a)({},o[0]),moves:{allowed:p.STATIONS.moves,executed:0}};e(b(a))}},setPiece:function(e,n,t,o){return function(a,c){var r=c(),i=r.game,u=i.activeTurn.player.id,y=i.turns.stage.type,b=r.board,m=b.config,w=m.rows,g=m.columns,O=b.gameMap[e][n],v=O.type,T=O.rotation;if(t!==v||o!==T){var j=function(e,n){console.log("Rotate connections called with rotation: ".concat(n," and connections:"),e);for(var t=Object(l.a)(e),o=n<0,a=Math.abs(n/90),c=0;c<a;c++)o?t.push(t.shift()):t.unshift(t.pop());return t}(d[t].connections,o);if(y===p.STATIONS.type){if(!function(e,n,t,o,a){console.log(a);var c=!0,r=[[e-1,n],[e,n+1],[e+1,n],[e,n-1]].reduce((function(e,n){var a=Object(f.a)(n,2),c=a[0],r=a[1];return[].concat(Object(l.a)(e),[+(0<=c&&c<t&&0<=r&&r<o)])}),[]);return a.map((function(e,n){1===e&&1!==r[n]&&(console.log("ILLEGAL MOVE. ".concat(s[n]," IS BLOCKED.")),c=!1)})),c}(e,n,w,g,j))return;var S=function(e,n,t,o,a){for(var c=[],r=e-a;r<=e+a;r++)for(var i=n-a;i<=n+a;i++)r>=0&&r<t&&i>=0&&i<o&&c.push([r,i]);return c}(e,n,w,g,2);console.log(S),S.map((function(e){a(I.apply(void 0,Object(l.a)(e)))}))}a(function(e,n,t){return{type:"SET_PIECE",payload:{x:e,y:n,piece:t}}}(e,n,{connections:j,enabled:!0,occupied:!0,ownerId:u,posX:e,posY:n,type:t,rotation:o})),a(E())}else console.log("No change registered. Not doing move.")}},playerMakeMove:E},z=Object(i.b)((function(e){return{board:e.board.gameMap,stage:e.game.turns.stage.type}}),J)((function(e){var n=e.board,t=e.rows,c=e.columns,r=e.stage,i=e.setPiece,l=e.initBoard,u=e.initPlayers;return Object(o.useEffect)((function(){l(),u()}),[]),a.a.createElement("div",{className:"game-board",style:{width:"calc(80px * ".concat(c,")")}},n.map((function(e,n){return e.map((function(e,o){var l=0==n&&0==o||n==t-1&&o==c-1||0==n&&o==c-1||n==t-1&&0==o;return a.a.createElement("div",{className:"cell \n                ".concat(o===c-1?"right-edge":""," \n                ").concat(n===t-1?"bottom-edge":""),style:{flex:"calc(100% / ".concat(c," - 1px) 0 0")},key:"cell-".concat(n).concat(o)},a.a.createElement(q,Object.assign({cornerPiece:l,posX:n,posY:o,setPiece:i,stage:r},e)))}))})))}));var Q={setRows:function(e){return{type:"SET_ROWS",payload:e}},setColumns:function(e){return{type:"SET_COLUMNS",payload:e}}},Z=Object(i.b)((function(e){return{rows:e.board.config.rows,columns:e.board.config.columns,stage:e.game.turns.stage.type,activePlayer:e.game.activeTurn}}),Q)((function(e){var n=e.rows,t=e.columns,o=e.setRows,c=e.setColumns,r=e.stage,i=e.activePlayer;return a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"controls"},a.a.createElement("label",null,"Rows:"),a.a.createElement("input",{type:"number",pattern:"[0-9]*",value:n,onChange:function(e){return o(e.target.value)}}),a.a.createElement("br",null),a.a.createElement("label",null,"Columns:"),a.a.createElement("input",{type:"number",pattern:"[0-9]*",value:t,onChange:function(e){return c(e.target.value)}}),a.a.createElement("br",null),a.a.createElement("h3",null,"Stage: ",r),i.player.name," make ",i.moves.allowed-i.moves.executed," moves"),a.a.createElement(z,{rows:n,columns:t}))})),$=(t(39),t(5)),ee=t(26),ne=t(4),te={config:{rows:8,columns:8},gameMap:[]},oe={playerCount:2,players:{},turns:{count:1,stage:""},activeTurn:{player:{},moves:{allowed:0,executed:0}}},ae=Object($.c)({board:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"SET_BOARD":return Object(u.a)({},e,{gameMap:n.payload});case"SET_ROWS":return Object(u.a)({},e,{config:Object(u.a)({},e.config,{rows:n.payload})});case"SET_COLUMNS":return Object(u.a)({},e,{config:Object(u.a)({},e.config,{columns:n.payload})});case"SET_PIECE":return Object(u.a)({},e,{gameMap:Object.assign(Object(l.a)(e.gameMap),Object(ne.a)({},n.payload.x,Object.assign(Object(l.a)(e.gameMap[n.payload.x]),Object(ne.a)({},n.payload.y,Object(u.a)({},n.payload.piece)))))});case"ENABLE_PIECE":return Object(u.a)({},e,{gameMap:Object.assign(Object(l.a)(e.gameMap),Object(ne.a)({},n.payload.x,Object.assign(Object(l.a)(e.gameMap[n.payload.x]),Object(ne.a)({},n.payload.y,Object(u.a)({},e.gameMap[n.payload.x][n.payload.y],{enabled:!0})))))});case"DISABLE_PIECE":return Object(u.a)({},e,{gameMap:Object.assign(Object(l.a)(e.gameMap),Object(ne.a)({},n.payload.x,Object.assign(Object(l.a)(e.gameMap[n.payload.x]),Object(ne.a)({},n.payload.y,Object(u.a)({},e.gameMap[n.payload.x][n.payload.y],{enabled:!1})))))});case"SET_LEGAL_MOVES":return Object(u.a)({},e,{gameMap:e.gameMap.map((function(e,t){return e.map((function(e,o){return n.payload.moves.includes("".concat(t,",").concat(o))?Object(u.a)({},e,{enabled:!0}):Object(u.a)({},e,{enabled:!1})}))}))});case"ENABLE_ALL_PIECES":return Object(u.a)({},e,{gameMap:e.gameMap.map((function(e){return e.map((function(e){return Object(u.a)({},e,{enabled:!0})}))}))});default:return e}},game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case"INIT_PLAYERS":return Object(u.a)({},e,{players:Object(u.a)({},n.payload)});case"SET_PLAYER_TURN":return Object(u.a)({},e,{turns:Object(u.a)({},e.turns,{active:n.payload})});case"SET_PLAYER_COUNT":return Object(u.a)({},e,{playerCount:n.payload});case"SET_PLAYERS":return Object(u.a)({},e,{players:n.payload});case"SET_GAME_STAGE":return Object(u.a)({},e,{turns:Object(u.a)({},e.turns,{stage:n.payload})});case"SET_ACTIVE_PLAYER":return Object(u.a)({},e,{activeTurn:n.payload});case"PLAYER_MOVE_ADD":return Object(u.a)({},e,{activeTurn:Object(u.a)({},e.activeTurn,{moves:Object(u.a)({},e.activeTurn.moves,{executed:e.activeTurn.moves.executed+1})})});default:return e}}}),ce=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||$.d,re=Object($.e)(ae,ce(Object($.a)(ee.a)));r.a.render(a.a.createElement(i.a,{store:re},a.a.createElement(Z,null)),document.getElementById("root"))}},[[27,1,2]]]);
//# sourceMappingURL=main.efccc650.chunk.js.map